<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home || Dashboard</title>
    <link rel="stylesheet" href="Styles/home_dashboard.css">
</head>

<body>
    <div class="nav">

        <a href=""><img src="Assets/Icons/logo_branca.png" alt=""></a>


        <div>
            <a href="./home_dash.html">Home</a>
            <a href="#">Dashboard</a>
            <a href="#">Relatórios</a>
            <img src="Assets/Icons/perfil.png" alt="" onclick="direcionar_perfil()">
        </div>

    </div>

    <main>

        <h1>Escolha uma das áreas de monitoramento disponíveis:</h1>

        <div class="listar_apas" id="listar_apas_id">

        </div>

    </main>


</body>

</html>

<script>

    async function listar_apas() {

        var idOrgao = sessionStorage.idOrgao;
        var mensagem = "";

        const resp = await fetch(`/medidas/listar_apas/${idOrgao}`);

        const resposta_apa = await resp.json();
        console.log(resposta_apa)
        for (var i = 0; i < resposta_apa.length; i++) {
            
            mensagem += `
            <div class="cartao">
                <h1>${resposta_apa[i].Nome_Atribuido}</h1>
                <img src="${resposta_apa[i].Imagem}" onclick = "redirecionar(${resposta_apa[i].idMonitoramento})">
            </div>
            `;
        }


        listar_apas_id.innerHTML = mensagem
    }

    function redirecionar(id){

        fetch(`/login/cadastro_acesso`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idMonitoramentoServer: id,
                idUsuarioServer: sessionStorage.idUsuario,
                idOrgaoServer:sessionStorage.idOrgao
            }),
        })



        sessionStorage.idMonitoramento = id;
        window.location = "./dashboard.html"
    }


    listar_apas();

</script>