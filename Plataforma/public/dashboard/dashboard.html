<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="Styles/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="../site institucional/novo/assets/imgs/Logo_com fundo.png" type="image/x-icon">
</head>

<body>
    <div class="nav">

        <a href=""><img src="Assets/Icons/logo_branca.png" alt=""></a>


        <div>
            <a href="#">Home</a>
            <a href="#">Dashboard</a>
            <a href="#">Relatórios</a>
            <a href=""><img src="Assets/Icons/perfil.png" alt=""></a>
        </div>

    </div>

    <div class="container">

        <div class="KPI">
            <div class="Status">
                <h1>Status dos Sensores</h1>
                <div>
                    <h4>Alertas</h4>
                    <div>
                        <img src="Assets/grid_img/aviso_temp_umid.png">
                        <h3 id="qtdAviso"></h3>
                    </div>
                </div>

                <div>
                    <h4>Perigo</h4>
                    <div>
                        <img src="Assets/grid_img/alerta_temp_umid.png" class="perigo">
                        <h3 id="qtdAlerta"></h3>
                    </div>
                </div>

                <div>
                    <h4>Manutenção</h4>
                    <div>
                        <img src="Assets/Icons/sem-sinal.png">
                        <h3 id="qtdManutencao"></h3>
                    </div>
                </div>
            </div>

            <div class="indicadores_grafico">
                <a href="../dashboard/dashboard_Sensor.html"></a>

                <div>
                    <h1>Alerta</h1>
                    <div>
                        <img id="metrica" src="Assets/Icons/alerta.png">
                        <img id="termometro" src="Assets/Icons/termometro.png">
                        <img id="umidade" src="Assets/Icons/umidade.png">
                        <h4 id="temperaturaMedia" style="display: none;"></h4>
                        <h3>34°C <br><br> 40%</h3>
                    </div>
                </div>


                <div>
                    <h1>Perigo</h1>
                    <div>
                        <img id="metrica" src="Assets/Icons/perigo.png">
                        <img id="termometro" src="Assets/Icons/termometro.png">
                        <img id="umidade" src="Assets/Icons/umidade.png">
                        <h4 id="umidadeMedia" style="display: none;"></h4>
                        <h3>38°C <br><br> 20%</h3>
                    </div>
                </div>

                <div>
                    <h1>Incêndio</h1>
                    <div>
                        <img id="metrica" src="Assets/grid_img/fogo.png">
                        <img id="termometro" src="Assets/Icons/termometro.png">
                        <img id="umidade" src="Assets/Icons/umidade.png">
                        <h4 id="metrica_incendio"></h4>
                        <h3>47°C <br><br> 20%</h3>
                    </div>
                </div>

            </div>
        </div>


        <div class="Graficos">
            <div class="areaGrid" id="grid">
                

                <div style="height: 100%; width: 100%;">
                    <img src="Assets/Icons/loading.gif" alt="">
                </div>

            </div>


            <div class="div_grafico">
                <canvas id="myChart"></canvas>
            </div>

        </div>
        <div class="Sensores">

            <div class="listSensores">
                <h2>Sensores</h2>
                <div class="Tabela_sensores" id="Listar_sensores">

                    <div>
                        <h1>Carregando...</h1>
                        <img src="Assets/Icons/loading.gif" alt="">
                    </div>

                </div>



            </div>


            <div class="KPI-Sensores">
                <div class="AtencaoSensores">
                    <h1>Atenção Necessária:</h1>
                    <div class="lista_Atencao" id="lista_atencao">

                    </div>
                </div>
            </div>


        </div>



    </div>


</body>

</html>



<script>

    sessionStorage.idMonitoramento = 1;

    function dashSensor() {
        window.location.href = "dashboard_Sensor.html";
    }





    async function buscarDados() {
        var idMonitoramento = sessionStorage.idMonitoramento
        const resp = await fetch(`/medidas/receber_dados/${idMonitoramento}`);
        if (resp.ok) {
            const resp_dados = await resp.json();

            console.log(resp_dados);
            setTimeout(() => listar_sensores(resp_dados), 2000);
        } else {
            console.error("Erro ao buscar dados:", resp.status);
        }



    }



    function listar_sensores(resp_dados) {
        var mensagem = ""
        var lista_grid = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
        var mensagem_grid = ''

        /*  Listando os sensores na lista */
        for (var i = 0; i < resp_dados.length; i++) {
            mensagem += `
            <div style = "cursor : pointer"onclick = "direcionar_pagina_individual(${resp_dados[i].ID})">
                <h1>${resp_dados[i].Nome_Sensor}</h1>
                <div>
                    <h1>${resp_dados[i].temperatura}C°</h1>
                    <h1>${resp_dados[i].umidade}%</h1>
                    <h1>${resp_dados[i].status_sensor}</h1>
                </div>
            </div> 
            
           `;
        }

        /* Fazendo o gráfico de grid */

        var contador_alerta = 0;
        var contador_perigo = 0;
        var contador_manutencao = 0;

        var posicaoAtual = 0;
        for (var i = 0; i < lista_grid.length; i++) {

            posicaoAtual = lista_grid[i];
            mensagem_grid += `  
                    <div class = "${posicaoAtual}">
            `;
            for (var j = 1; j < 10; j++) {
                for (var k = 0; k < resp_dados.length; k++) {
                    if (resp_dados[k].Nome_Sensor.includes(`${posicaoAtual}${j}-${sessionStorage.idMonitoramento}`)) {
                        var inclui = true
                        var id = resp_dados[k].ID;

                        if(resp_dados[k].temperatura == 0 || resp_dados[k].umidade == 0){
                            contador_manutencao++;
                        }
                        else if(resp_dados[k].temperatura == 34 || resp_dados[k].umidade == 40 ){
                            contador_alerta++;
                        }else if(resp_dados[k].temperatura == 38 || resp_dados[k].umidade == 20){
                            contador_perigo++;
                        }
                        
                        break;
                    } else {
                        inclui = false
                    }
                }
                if (inclui) {
                    mensagem_grid += `
                     <div id="${posicaoAtual}${j}-${sessionStorage.idMonitoramento}" onclick="direcionar_pagina_individual(${id})" style="cursor: pointer;">
                        <img src="Assets/grid_img/sensor.png" alt="">
                    </div>
                    `
                } else {
                    mensagem_grid += `<div></div>`
                }
            }

            mensagem_grid += "</div>"
        }



        grid.innerHTML = mensagem_grid
        qtdAviso.innerHTML = contador_perigo ;
        qtdAlerta.innerHTML = contador_alerta;
        qtdManutencao.innerHTML = contador_manutencao;
        Listar_sensores.innerHTML = mensagem
    }

     function direcionar_pagina_individual(id_sensor) {
        sessionStorage.id_sensor =  id_sensor;
        console.log(id_sensor)
        window.location = '../dashboard/dashboard_Sensor.html'
    }

    buscarDados();

</script>



<!-- Caso precise lucas -->


<!--  <div class="A">
                    <div id="A1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A2"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A3"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A4"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A5"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A6"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A7" onclick="dashSensor()" style="cursor: pointer;">
                        <img src="Assets/grid_img/sensor.png" alt="">
                    </div>
                    <div id="A8"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="A9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="B">
                    <div id="B1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="B2"></div>
                    <div id="B3"></div>
                    <div id="B4"></div>
                    <div id="B5"></div>
                    <div id="B6"></div>
                    <div id="B7"></div>
                    <div id="B8"></div>
                    <div id="B9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="C">
                    <div id="C1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="C2"></div>
                    <div id="C3"></div>
                    <div id="C4"></div>
                    <div id="C5"></div>
                    <div id="C6"></div>
                    <div id="C7"></div>
                    <div id="C8"></div>
                    <div id="C9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="D">
                    <div id="D1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="D2"></div>
                    <div id="D3"></div>
                    <div id="D4"></div>
                    <div id="D5"></div>
                    <div id="D6"></div>
                    <div id="D7"></div>
                    <div id="D8"></div>
                    <div id="D9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="E">
                    <div id="E1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="E2"></div>
                    <div id="E3"></div>
                    <div id="E4"></div>
                    <div id="E5"></div>
                    <div id="E6"></div>
                    <div id="E7"></div>
                    <div id="E8"></div>
                    <div id="E9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="F">
                    <div id="F1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="F2"></div>
                    <div id="F3"></div>
                    <div id="F4"></div>
                    <div id="F5"></div>
                    <div id="F6"></div>
                    <div id="F7"></div>
                    <div id="F8"></div>
                    <div id="F9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>



                <div class="G">
                    <div id="G1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="G2"></div>
                    <div id="G3"></div>
                    <div id="G4"></div>
                    <div id="G5"></div>
                    <div id="G6"></div>
                    <div id="G7"></div>
                    <div id="G8"></div>
                    <div id="G9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="H">
                    <div id="H1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="H2"></div>
                    <div id="H3"></div>
                    <div id="H4"></div>
                    <div id="H5"></div>
                    <div id="H6"></div>
                    <div id="H7"></div>
                    <div id="H8"></div>
                    <div id="H9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>


                <div class="I">
                    <div id="I1"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I2"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I3"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I4"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I5"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I6"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I7"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I8"><img src="Assets/grid_img/sensor.png" alt=""></div>
                    <div id="I9"><img src="Assets/grid_img/sensor.png" alt=""></div>
                </div>
 -->