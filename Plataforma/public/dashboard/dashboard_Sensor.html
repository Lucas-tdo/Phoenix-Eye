<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="id_Title">Sensor</title>
    <link rel="stylesheet" href="Styles/dashboard_Sensor.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="../site institucional/novo/assets/imgs/Logo_com fundo.png" type="image/x-icon">
</head>



<body>
    <div class="nav">

        <a href=""><img src="Assets/Icons/logo_branca.png" alt=""></a>


        <div>
            <a href="#">Home</a>
            <a href="#">Dashboard</a>
            <a href="#">Relatórios</a>
            <a href=""><img src="Assets/Icons/perfil.png" alt=""></a>
        </div>

    </div>

    <div class="container" id="div_container">

        <div class="KPI">
            <div class="Status">
                <h1>Dados em tempo real!</h1>
                <div>
                    <h4>Temperatura</h4>
                    <div>
                        <img src="Assets/Icons/termometro.png">
                        <h3><span id="tempSensorDash"></span>º</h3>
                    </div>
                </div>

                <div>
                    <h4>Umidade</h4>
                    <div>
                        <img src="Assets/Icons/umidade.png" class="perigo">
                        <h3><span id="umidSensorDash"></span>%</h3>
                    </div>
                </div>

                <div class="Situacao">
                    <h4>Situação</h4>
                    <div>
                        <img src="Assets/Icons/loading.gif" id="situacao_Dash" style="height: 70px; width: 70px;">
                    </div>
                </div>
            </div>

            <div class="Nome_Sensor">
                <h1>Sensor <span id="Nome_Sensor"></span></h1>
            </div>
        </div>


        <div class="graficos" id="div_grafico">

            <div class="Graf_Temp_Atuais">
                <div>
                    <h4>Temperatura em tempo real</h4>
                    <canvas id="myChart"></canvas>
                </div>

                <div>
                    <h4>Umidade em tempo real</h4>
                    <canvas id="myChart2"></canvas>
                </div>
            </div>
        </div>

        <div class="kpi_E_Manutencao" id="div_kpi">

            <div class="GraficoMedia">
                <h4>Média comparada a máxima do dia</h4>
                <canvas id="myChartBar"></canvas>
            </div>

            <div class="historicoAtencao">
                <h2>Ocorrências</h2>
                <div class="Ocorrencias">
                    <div>
                        <img src="Assets/grid_img/alerta_temp.png" style="height: 60px; margin-left: 20px;">
                        <div>
                            <h3>Alerta de temperatura</h3>
                            <p>Temperatura em medidas críticas!. <br> Necessária tomada urgente de ação!</p>
                            <div>
                                <p>Data: <b>19/04/2025</b></p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <img src="Assets/grid_img/aviso_temp_umid.png" style="height: 60px; margin-left: 20px;">
                        <div>
                            <h3>Alerta de temperatura</h3>
                            <p>Temperatura e umidade <br>fora dos padrões normais. <br> Necessária tomada de ação!</p>
                            <div>
                                <p>Data: <b>01/04/2025</b></p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <img src="Assets/grid_img/alerta_temp.png" style="height: 60px; margin-left: 20px;">
                        <div>
                            <h3>Alerta de temperatura</h3>
                            <p>Temperatura em medidas críticas!. <br> Necessária tomada urgente de ação!</p>
                            <div>
                                <p>Data: <b>10/03/2025</b></p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>


        <div class="aviso" id="div_aviso">

            <h1>Sensor em manutenção! Por favor retorne em outro momento.</h1>

        </div>

    </div>
    <div class="footer">

        <a href="dashboard.html"><img src="Assets/Icons/flecha.png"></a>

    </div>
</body>

</html>

<img src="Assets/grid_img/sensor.png" alt="">

<script>

    var id_sensor = sessionStorage.id_sensor;
    const ctx = document.getElementById('myChart');

        const ctx2 = document.getElementById('myChart2');
   
   
           new Chart(ctx2, {
               type: 'line',
               data: {
                   labels: ['0h', '1h', '2h', '3h', '4h', '5h', '6h', '7h', '8h', '9h', '10h', '11h', '12h', '13h', '14h', '15h', '16h', '17h', '18h', '19h', '20h', '21h', '22h', '23h'],
                   datasets: [
   
                       {
                           label: 'Aviso',
                           data: [5,5,5,5,5,5,5],
                           borderWidth: 2,
                           borderColor: 'rgb(255, 251, 8)',
                           backgroundColor: 'rgb(255, 251, 8)',
   
                       }
                       , {
                           label: 'Alerta',
                           data: [5,5,5,5,5,5,],
                           borderWidth: 2,
                           borderColor: 'rgb(255, 0, 0)',
                           backgroundColor: 'rgb(255, 0, 0)',
   
                       }
                       , {
                           label: 'Umidade',
                           data: [75, 76, 78, 80, 82, 81, 79, 78, 76, 5],
                           borderWidth: 5,
                           borderColor: 'rgb(54, 162, 235)',
                           backgroundColor: 'rgb(54, 162, 235)',
                       }
                       ,
   
                   ]
               },
               options: {
                   plugins: {
                       legend: {
                           position: 'bottom',
                           labels: {
                               padding: 30,
                               font: {
                                   size: 14, 
                                   weight : 600, 
                                 
                               },
                               color: 'rgb(26, 51, 32);' 
                           }
                       }
                   },
                   scales: {
                       x: {
                           ticks: {
                               color: 'rgb(26, 51, 32);',
                           }
                           
                       },
                       y: {
                           ticks: {
                               color: 'rgb(26, 51, 32);' 
                           },
                           beginAtZero: true
                       },
   
                   }
               }
           });


        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['0h', '1h', '2h', '3h', '4h', '5h', '6h'],
                datasets: [
                    {
                        label: 'Aviso',
                        data: [34, 34, 34, 34, 34, 34, 34, 34, 34, 34],
                        borderWidth: 2,
                        borderColor: 'rgb(255, 251, 8)',
                        backgroundColor: 'rgb(255, 251, 8)',
                    }, {
                        label: 'Alerta',
                        data: [38, 38, 38, 38, 38, 38, 38, 38, 38, 38],
                        borderWidth: 2,
                        borderColor: 'rgb(255, 123, 0)',
                        backgroundColor: 'rgb(255, 123, 0)',
                    },
                    {
                        label: 'Incêndio',
                        data: [47, 47, 47, 47, 47, 47, 47, 47, 47, 47],
                        borderWidth: 2,
                        borderColor: 'rgb(255, 0, 0)',
                        backgroundColor: 'rgb(255, 0, 0)',
                    },
                    {
                        label: 'Temperatura',
                        data: [38, 23, 25, 27, 27, 29, 28, 26, 24, 38],
                        borderWidth: 5,
                        borderColor: 'rgb(0, 128, 0)',
                        backgroundColor: 'rgb(0, 128, 0)',
                    },

                ]
            },
            options: {

                plugins: {
                    legend: {

                        position: 'bottom',
                        labels: {
                            padding: 30,
                            font: {
                                size: 14,
                                weight: 600,

                            },
                            color: 'rgb(26, 51, 32);'
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: 'rgb(26, 51, 32);'
                        }
                    },
                    y: {
                        ticks: {
                            color: 'rgb(26, 51, 32);'
                        },
                        beginAtZero: true
                    },

                }
            }
        });
        


    async function puxar_dados_sensor() {

        div_aviso.style.display = "none"

        const resp = await fetch(`/medidas/dados_sensor_especifico/${id_sensor}`)
        const resp_dados = await resp.json();

        id_Title.innerHTML = "Dash:" + (Nome_Sensor.innerHTML = resp_dados[0].nome);

        tempSensorDash.innerHTML = resp_dados[0].temperatura
        umidSensorDash.innerHTML = resp_dados[0].umidade
        Nome_Sensor.innerHTML = resp_dados[0].nome

        if (resp_dados[0].status_sensor == "Manutencao") {
            div_grafico.style.display = "none";
            div_kpi.style.display = "none";
            div_aviso.style.display = "flex"
            tempSensorDash.innerHTML = "Erro!"
            umidSensorDash.innerHTML = "Erro!"
        }



        /* ARRUMAR A INCONSISTÊNCIA DOS DADOS */

        if (resp_dados[0].Situacao_dado == "Alerta") {
            situacao_Dash.src = "Assets/Icons/alerta.png"

        } else if (resp_dados[0].Situacao_dado == "Perigo") {
            situacao_Dash.src = "Assets/Icons/perigo.png"
        } else if (resp_dados[0].status_sensor == "Manutencao") {

            situacao_Dash.src = "Assets/Icons/sem-sinal.png"

        } else {
            situacao_Dash.src = "Assets/grid_img/sensor.png"
        }

    }


    function chamar(){
        setTimeout(() => {
        puxar_dados_sensor();
        chamar()
    }, 3000)
    }
    

    chamar()

</script>